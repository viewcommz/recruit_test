// --------------------------------------------------------------------------------
// Default
// --------------------------------------------------------------------------------
const express      = require('express');
const app          = express();

// --------------------------------------------------------------------------------
// Dependency
// --------------------------------------------------------------------------------
const bodyParser   = require('body-parser');
const cors         = require('cors');
const http         = require('http');
const fs           = require('fs');
const port         = 4000;
const server       = http.createServer(app);

// --------------------------------------------------------------------------------
// Database
// --------------------------------------------------------------------------------
require('dotenv').config();
const pool = require('mysql').createPool({
  database        : process.env.DATABASE,
  host            : process.env.HOST,
  port            : process.env.PORT,
  user            : process.env.USER,
  password        : process.env.PASSWORD,
});

// --------------------------------------------------------------------------------
// Cors
// --------------------------------------------------------------------------------
app.use(cors({ origin : '*' }));

// --------------------------------------------------------------------------------
// Parser
// --------------------------------------------------------------------------------
app.use(bodyParser.json());
app.use(bodyParser.urlencoded({ extended: true }));

// --------------------------------------------------------------------------------
// Router
// --------------------------------------------------------------------------------
let router = require('./router')(pool);
app.use('/', router);

// --------------------------------------------------------------------------------
// Server
// --------------------------------------------------------------------------------
app.set('port', port);
server.listen(port, () => console.log('Test Server is Ready'));

module.exports = app;